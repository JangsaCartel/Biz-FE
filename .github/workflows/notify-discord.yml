name: Discord Notify (Embed)

on:
  pull_request:
    types: [opened, closed] # ìƒì„±/ë¨¸ì§€/ë‹«í˜
  issues:
    types: [opened] # ì´ìŠˆ ìƒì„±

jobs:
  notify:
    runs-on: ubuntu-latest
    env:
      DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
      REPO: ${{ github.repository }}
      ACTOR: ${{ github.actor }}

    steps:
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq curl

      - name: Notify PR Opened
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        run: |
          jq -n \
            --arg title "âœ¨ New Pull Request" \
            --arg url "${{ github.event.pull_request.html_url }}" \
            --arg branch "${{ github.event.pull_request.head.ref }}" \
            --arg number "#${{ github.event.pull_request.number }}" \
            --arg prtitle "${{ github.event.pull_request.title }}" \
            --arg author "${ACTOR}" \
            '{
              embeds: [
                {
                  title: $title,
                  url: $url,
                  color: 3447003, # íŒŒë€ìƒ‰
                  fields: [
                    {name: "ğŸ“Œ Repo", value: env.REPO, inline: true},
                    {name: "ğŸ”¢ PR", value: ($number + " - " + $prtitle), inline: false},
                    {name: "ğŸŒ¿ Branch", value: $branch, inline: true},
                    {name: "ğŸ‘¤ Author", value: $author, inline: true}
                  ]
                }
              ]
            }' \
          | curl -sS -H "Content-Type: application/json" -d @- "$DISCORD_WEBHOOK"

      - name: Notify PR Merged
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        run: |
          jq -n \
            --arg title "âœ… Pull Request Merged" \
            --arg url "${{ github.event.pull_request.html_url }}" \
            --arg number "#${{ github.event.pull_request.number }}" \
            --arg prtitle "${{ github.event.pull_request.title }}" \
            --arg author "${ACTOR}" \
            '{
              embeds: [
                {
                  title: $title,
                  url: $url,
                  color: 3066993, # ì´ˆë¡ìƒ‰
                  fields: [
                    {name: "ğŸ“Œ Repo", value: env.REPO, inline: true},
                    {name: "ğŸ”¢ PR", value: ($number + " - " + $prtitle), inline: false},
                    {name: "ğŸ§‘â€ğŸ’» Merged by", value: $author, inline: true}
                  ]
                }
              ]
            }' \
          | curl -sS -H "Content-Type: application/json" -d @- "$DISCORD_WEBHOOK"

      - name: Notify PR Closed (Not Merged)
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == false
        run: |
          jq -n \
            --arg title "ğŸ›‘ Pull Request Closed (Not Merged)" \
            --arg url "${{ github.event.pull_request.html_url }}" \
            --arg number "#${{ github.event.pull_request.number }}" \
            --arg prtitle "${{ github.event.pull_request.title }}" \
            --arg author "${ACTOR}" \
            '{
              embeds: [
                {
                  title: $title,
                  url: $url,
                  color: 15158332, # ë¹¨ê°„ìƒ‰
                  fields: [
                    {name: "ğŸ“Œ Repo", value: env.REPO, inline: true},
                    {name: "ğŸ”¢ PR", value: ($number + " - " + $prtitle), inline: false},
                    {name: "ğŸ‘¤ Closed by", value: $author, inline: true}
                  ]
                }
              ]
            }' \
          | curl -sS -H "Content-Type: application/json" -d @- "$DISCORD_WEBHOOK"

      - name: Notify Issue Opened
        if: github.event_name == 'issues' && github.event.action == 'opened'
        run: |
          jq -n \
            --arg title "ğŸ“ New Issue" \
            --arg url "${{ github.event.issue.html_url }}" \
            --arg number "#${{ github.event.issue.number }}" \
            --arg issuetitle "${{ github.event.issue.title }}" \
            --arg author "${ACTOR}" \
            '{
              embeds: [
                {
                  title: $title,
                  url: $url,
                  color: 10181046, # ë³´ë¼ìƒ‰
                  fields: [
                    {name: "ğŸ“Œ Repo", value: env.REPO, inline: true},
                    {name: "ğŸ”¢ Issue", value: ($number + " - " + $issuetitle), inline: false},
                    {name: "ğŸ‘¤ Author", value: $author, inline: true}
                  ]
                }
              ]
            }' \
          | curl -sS -H "Content-Type: application/json" -d @- "$DISCORD_WEBHOOK"
